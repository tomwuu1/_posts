---
title: 发布方式
date: 2024-08-08 11:37:14
tags:
---

# 滚动发布

- 将新版本逐批发布到服务器上

优点：资源利用率高

缺点：回滚复杂



# 灰度发布

主要是对于流量进行控制

1. 选择一部分流量作为测试
2. 通过监控和日志观察运行情况
3. 如果表现良好可以逐步增加流量，直到覆盖全部

缺点：数据一致性问题



# 蓝绿发布

维持两个环境，把所有的流量切到新的的环境。但是旧环境的数据库连接等是不关闭的。

优点：快速回滚

缺点：需要额外的资源

# 发布过程

编译->部署

灰度和线上的区别：灰度不会合并master

# kvm发布和docker发布

kvm：服务器下线，上线，固定ip

docker：服务上线，就服务回收，不固定IP

1. docker发布的过程

2. kvm发布过程

# jar包发布

测试环境：snapshot。灰度pre。线上release

# 回滚

1. 发布过程中线上业务或监控出现异常，与自己发布的时间点吻合，立即回滚
2. 发布过程中出现未知问题无法定位，立刻回滚
3. 发布完成，线上验证发现影响线上核心功能，立刻回滚

https://noc.corp.qunar.com/看谁发布了

回滚部署之后会加回滚锁

# 如何回滚

1. 提前准备回滚内容
2. 线上发布时发现有回滚，咨询回滚发布人

# 故障

出现故障@noc

# 发布前确认

1. 代码
2. 资源申请
3. 权限（日志查看，监控面板）



